{"config":{"indexing":"full","lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"PR\u00c1CTICA 2.5: Proxy inverso y balanceo de carga con SSL en NGINX Creac\u00edon de la clave y certificado ssl En primer lugar crearemos el directorio donde guardaremos la clave y el certificado ssl dentro de nuestro servidor nginx: y con el siguiente comando lo crearemos, e iremos rellenando los campos que nos pidan: Configuraci\u00f3n de SSL en el proxy inverso Nos dirigimos hacia el archivo de configuraci\u00f3n de balanceo, creado en la pr\u00e1ctica anterior, y a\u00f1adimos las siguientes l\u00edneas: Adem\u00e1s hemos cambiado el puerto de escucha (anteriormente 80) a 443, que es el puerto predeterminado de HTTPS. Comprobaciones Nos dirigimos hacia https:/deaw_manuel, a lo cual el navegador nos dar\u00e1 el siguiente aviso de seguiridad: Si pinchamos en m\u00e1s informaci\u00f3n se nos abrir\u00e1 la siguiente ventana: Y presionamos sobre \"Ver certificado\", para ver los siguientes detalles: Si en este momento intentamos acceder a la p\u00e1gina mediante el protocolo http, se nos muestra la p\u00e1gina aparentemente normal: Pero en realidad no se est\u00e1 realizando el balanceo, ya que no se ha redirigido a el HTTPS, lo cual arreglaremos a continuaci\u00f3n. Redirecci\u00f3n forzosa a HTTPS Para conseguirlo, crearemos un nuevo apartado server dentro del archivo de configuraci\u00f3n ya mencionado, y a\u00f1adiremos lo siguiente: Nota: La imagen la tom\u00e9 antes de a\u00f1adir una llave al final \"}\" lo cu\u00e1l me generaba un error. La redirecci\u00f3n 301 es un c\u00f3digo o comando insertado por un Webmaster que permite redirigir a los usuarios y buscadores de un sitio web de un sitio a otro. Es decir, lo que estamos haciendo es que cuando se reciba una petici\u00f3n HTTP (puerto 80) en http://balanceo, se redirija a https://balanceo (HTTPS) Cuestiones Finales Cuesti\u00f3n 1 Hemos configurado nuestro proxy inverso con todo lo que nos hace falta pero no nos funciona y da un error del tipo This site can't provide a secure connection, ERR_SSL_PROTOCOL_ERROR. Dentro de nuestro server block tenemos esto: server { listen 443; ssl_certificate /etc/nginx/ssl/enrico-berlinguer/server.crt; ssl_certificate_key /etc/nginx/ssl/enrico-berlinguer/server.key; ssl_protocols TLSv1.3; ssl_ciphers ECDH+AESGCM:DH+AESGCM:ECDH+AES256:DH+AES256:ECDH+AES128:DH+AES:ECDH+3DES:DH+3DES:RSA+AESGCM:RSA+AES:RSA+3DES:!aNULL:!MD5:!DSS; server_name enrico-berlinguer; access_log /var/log/nginx/https_access.log; location / { proxy_pass http://red-party; } } Se puede deber a que no se han creado adecuadamente los certificados ssl de la web. Cuesti\u00f3n 2 Imaginad que intentamos acceder a nuestro sitio web HTTPS y nos encontramos con el siguiente error: Investigad qu\u00e9 est\u00e1 pasando y como se ha de solucionar.","title":"PR\u00c1CTICA 2.5: Proxy inverso y balanceo de carga con SSL en NGINX"},{"location":"#practica-25-proxy-inverso-y-balanceo-de-carga-con-ssl-en-nginx","text":"","title":"PR\u00c1CTICA 2.5: Proxy inverso y balanceo de carga con SSL en NGINX"},{"location":"#creacion-de-la-clave-y-certificado-ssl","text":"En primer lugar crearemos el directorio donde guardaremos la clave y el certificado ssl dentro de nuestro servidor nginx: y con el siguiente comando lo crearemos, e iremos rellenando los campos que nos pidan:","title":"Creac\u00edon de la clave y certificado ssl"},{"location":"#configuracion-de-ssl-en-el-proxy-inverso","text":"Nos dirigimos hacia el archivo de configuraci\u00f3n de balanceo, creado en la pr\u00e1ctica anterior, y a\u00f1adimos las siguientes l\u00edneas: Adem\u00e1s hemos cambiado el puerto de escucha (anteriormente 80) a 443, que es el puerto predeterminado de HTTPS.","title":"Configuraci\u00f3n de SSL en el proxy inverso"},{"location":"#comprobaciones","text":"Nos dirigimos hacia https:/deaw_manuel, a lo cual el navegador nos dar\u00e1 el siguiente aviso de seguiridad: Si pinchamos en m\u00e1s informaci\u00f3n se nos abrir\u00e1 la siguiente ventana: Y presionamos sobre \"Ver certificado\", para ver los siguientes detalles: Si en este momento intentamos acceder a la p\u00e1gina mediante el protocolo http, se nos muestra la p\u00e1gina aparentemente normal: Pero en realidad no se est\u00e1 realizando el balanceo, ya que no se ha redirigido a el HTTPS, lo cual arreglaremos a continuaci\u00f3n.","title":"Comprobaciones"},{"location":"#redireccion-forzosa-a-https","text":"Para conseguirlo, crearemos un nuevo apartado server dentro del archivo de configuraci\u00f3n ya mencionado, y a\u00f1adiremos lo siguiente: Nota: La imagen la tom\u00e9 antes de a\u00f1adir una llave al final \"}\" lo cu\u00e1l me generaba un error. La redirecci\u00f3n 301 es un c\u00f3digo o comando insertado por un Webmaster que permite redirigir a los usuarios y buscadores de un sitio web de un sitio a otro. Es decir, lo que estamos haciendo es que cuando se reciba una petici\u00f3n HTTP (puerto 80) en http://balanceo, se redirija a https://balanceo (HTTPS)","title":"Redirecci\u00f3n forzosa a HTTPS"},{"location":"#cuestiones-finales","text":"","title":"Cuestiones Finales"},{"location":"#cuestion-1","text":"Hemos configurado nuestro proxy inverso con todo lo que nos hace falta pero no nos funciona y da un error del tipo This site can't provide a secure connection, ERR_SSL_PROTOCOL_ERROR. Dentro de nuestro server block tenemos esto: server { listen 443; ssl_certificate /etc/nginx/ssl/enrico-berlinguer/server.crt; ssl_certificate_key /etc/nginx/ssl/enrico-berlinguer/server.key; ssl_protocols TLSv1.3; ssl_ciphers ECDH+AESGCM:DH+AESGCM:ECDH+AES256:DH+AES256:ECDH+AES128:DH+AES:ECDH+3DES:DH+3DES:RSA+AESGCM:RSA+AES:RSA+3DES:!aNULL:!MD5:!DSS; server_name enrico-berlinguer; access_log /var/log/nginx/https_access.log; location / { proxy_pass http://red-party; } } Se puede deber a que no se han creado adecuadamente los certificados ssl de la web.","title":"Cuesti\u00f3n 1"},{"location":"#cuestion-2","text":"Imaginad que intentamos acceder a nuestro sitio web HTTPS y nos encontramos con el siguiente error: Investigad qu\u00e9 est\u00e1 pasando y como se ha de solucionar.","title":"Cuesti\u00f3n 2"}]}